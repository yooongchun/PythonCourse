<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <script type="text/javascript" src="http://gc.kis.v2.scr.kaspersky-labs.com/C8BAC707-C937-574F-9A1F-B6E798DB62A0/main.js" charset="UTF-8"></script><script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=x2ZTlRkWM2FYoQbvGOufPnFK3Fx4vFR1"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>
    <title>热力图功能示例</title>
    <style type="text/css">
		ul,li{list-style: none;margin:0;padding:0;float:left;}
		html{height:100%}
		body{height:100%;margin:0px;padding:0px;font-family:"微软雅黑";}
		#container{height:500px;width:100%;}
		#r-result{width:100%;}
    </style>	
</head>
<body>
	<div id="container"></div>
	<div id="r-result">
		<input type="button"  onclick="openHeatmap();" value="显示热力图"/><input type="button"  onclick="closeHeatmap();" value="关闭热力图"/>
	</div>
</body>
</html>
<script type="text/javascript">
    var map = new BMap.Map("container");          // 创建地图实例

    var point = new BMap.Point(105.418261, 35.921984);
    map.centerAndZoom(point, 5);             // 初始化地图，设置中心点坐标和地图级别
    map.enableScrollWheelZoom(); // 允许滚轮缩放
  
    var points =[
{"lng":116.4224009776628,"lat":39.93482727239599, "count":4}, 
{"lng":121.42743470427969,"lat":28.66219405599615, "count":1}, 
{"lng":121.44339635276381,"lat":31.194556772822725, "count":6}, 
{"lng":117.2095232146708,"lat":39.093667843403956, "count":2}, 
{"lng":116.3054340544974,"lat":39.96548984110075, "count":27}, 
{"lng":120.39198356183466,"lat":31.64214013069237, "count":3}, 
{"lng":121.49158559252436,"lat":31.23724715206362, "count":4}, 
{"lng":100.09544042014869,"lat":23.89046855627851, "count":17}, 
{"lng":121.40356934916508,"lat":31.254973368279597, "count":2}, 
{"lng":105.4485240693266,"lat":28.87766830360723, "count":1}, 
{"lng":121.45343177276851,"lat":31.233844930401652, "count":3}, 
{"lng":105.95441712388904,"lat":26.25925237871499, "count":2}, 
{"lng":115.7844632112745,"lat":33.850642695788835, "count":2}, 
{"lng":121.38861193361008,"lat":31.118842580087428, "count":49}, 
{"lng":121.48053886017651,"lat":31.235929042252014, "count":18}, 
{"lng":121.34848004512126,"lat":30.747852376570318, "count":1}, 
{"lng":104.6855618607612,"lat":31.473663048745863, "count":1}, 
{"lng":113.24673243447106,"lat":23.19047307302247, "count":14}, 
{"lng":117.15651537432414,"lat":39.14410527976771, "count":2}, 
{"lng":120.21551180372168,"lat":30.25308298169347, "count":10}, 
{"lng":113.99743053873469,"lat":22.53581126769833, "count":8}, 
{"lng":114.27466263556104,"lat":30.587155395568026, "count":9}, 
{"lng":103.93717563531006,"lat":30.608293840569402, "count":14}, 
{"lng":120.53447528017826,"lat":27.579509190145334, "count":2}, 
{"lng":121.61556655498568,"lat":25.220154419135568, "count":1}, 
{"lng":121.55045460683195,"lat":31.227348292436346, "count":14}, 
{"lng":117.12639941261048,"lat":36.65655420178723, "count":3}, 
{"lng":112.57844721325992,"lat":26.899576139189122, "count":3}, 
{"lng":102.47404642159835,"lat":24.917734785759006, "count":9}, 
{"lng":121.14878143025066,"lat":30.188062675913905, "count":3}, 
{"lng":117.02344756677536,"lat":25.081219844871676, "count":1}, 
{"lng":123.47109664482264,"lat":41.68383006919066, "count":1}, 
{"lng":116.4133836971231,"lat":39.910924547299565, "count":11}, 
{"lng":108.94646555063274,"lat":34.34726881662395, "count":5}, 
{"lng":116.44955872950158,"lat":39.926374523079886, "count":18}, 
{"lng":116.348625212231,"lat":39.73255523655448, "count":2}, 
{"lng":101.00086302472202,"lat":22.768219015105014, "count":1}, 
{"lng":99.17727328581788,"lat":25.139038793265964, "count":1}, 
{"lng":111.29254921035434,"lat":30.697446484492378, "count":2}, 
{"lng":121.25052297332745,"lat":37.56863096272401, "count":1}, 
{"lng":118.92040902964006,"lat":32.084060015522816, "count":5}, 
{"lng":126.54161509031663,"lat":45.808825827952184, "count":5}, 
{"lng":115.82043612491321,"lat":32.89606099485221, "count":1}, 
{"lng":106.5804150623847,"lat":29.612832314080265, "count":2}, 
{"lng":117.94945960312224,"lat":28.460625921851733, "count":2}, 
{"lng":120.56881742689869,"lat":30.614333706138147, "count":1}, 
{"lng":120.31068763182607,"lat":35.99530630404869, "count":6}, 
{"lng":113.13548942422142,"lat":29.3631782939259, "count":2}, 
{"lng":120.82721177294401,"lat":32.03715144622351, "count":2}, 
{"lng":118.68244626680422,"lat":24.879952330498313, "count":4}, 
{"lng":110.931542579969,"lat":21.669064031332095, "count":2}, 
{"lng":112.5137395867361,"lat":37.86924926423041, "count":2}, 
{"lng":116.01427919626163,"lat":28.71238383669176, "count":2}, 
{"lng":120.59241222959322,"lat":31.303564074441766, "count":2}, 
{"lng":117.65357645298785,"lat":24.51892979117087, "count":1}, 
{"lng":121.27259505835202,"lat":31.3801553396772, "count":3}, 
{"lng":118.68138493513693,"lat":37.43964182632334, "count":1}, 
{"lng":119.9286590492897,"lat":31.002647538119874, "count":3}, 
{"lng":119.35038995226057,"lat":26.058660737766438, "count":3}, 
{"lng":121.23447959624146,"lat":31.037135176464492, "count":3}, 
{"lng":108.77759119834955,"lat":29.53881256766016, "count":1}, 
{"lng":119.39665539745437,"lat":32.35535748049656, "count":1}, 
{"lng":119.41396861920929,"lat":36.07747405526332, "count":2}, 
{"lng":108.360418838298,"lat":21.6930052899694, "count":1}, 
{"lng":105.72840462545042,"lat":29.713113506076837, "count":1}, 
{"lng":113.72454436897033,"lat":22.959019707800906, "count":1}, 
{"lng":118.13790882785968,"lat":26.20262659920472, "count":1}, 
{"lng":106.54745425696237,"lat":29.408474739770405, "count":1}, 
{"lng":116.23761791731043,"lat":40.22641337159427, "count":3}, 
{"lng":119.22862133316607,"lat":34.60224952526725, "count":1}, 
{"lng":106.55843415537664,"lat":29.568996245338923, "count":2}, 
{"lng":113.00278697331211,"lat":28.186192975476388, "count":3}, 
{"lng":113.63141920733915,"lat":34.75343885045448, "count":4}, 
{"lng":118.13611095921262,"lat":24.479151007868538, "count":4}, 
{"lng":117.25841295306803,"lat":39.134487325955114, "count":1}, 
{"lng":111.52553022403073,"lat":36.093741895419726, "count":2}, 
{"lng":121.1354378034413,"lat":29.527366370598937, "count":1}, 
{"lng":114.19855413556934,"lat":22.325722838593258, "count":1}, 
{"lng":114.87849048410779,"lat":30.4593588576181, "count":2}, 
{"lng":125.3306020759069,"lat":43.82195350104314, "count":1}, 
{"lng":117.2658379870913,"lat":31.884584000688, "count":3}, 
{"lng":119.93801310456512,"lat":31.858268321210033, "count":2}, 
{"lng":121.4965630135246,"lat":31.41027947347614, "count":3}, 
{"lng":101.62247338027404,"lat":34.740396071091155, "count":1}, 
{"lng":119.77237049946636,"lat":49.21844647556481, "count":1}, 
{"lng":109.51855670139908,"lat":18.258736291747855, "count":1}, 
{"lng":116.59361234853988,"lat":35.420177394529645, "count":1}, 
{"lng":121.62163148459285,"lat":38.9189536667856, "count":3}, 
{"lng":118.36353300501388,"lat":35.11067124236514, "count":1}, 
{"lng":113.99725042847999,"lat":22.536472468017156, "count":1}, 
{"lng":123.92457086841536,"lat":47.3599771860153, "count":1}, 
{"lng":101.62247338027404,"lat":34.740396071091155, "count":1}, 
{"lng":106.93342774801829,"lat":27.731700878916666, "count":1}, 
{"lng":113.0677472176003,"lat":23.03670052804423, "count":1}, 
{"lng":109.51658960525897,"lat":34.50571551675255, "count":1}, 
{"lng":103.84052119633628,"lat":36.067234693545565, "count":1}, 
{"lng":116.29240188731139,"lat":39.8649371975573, "count":1}, 
{"lng":106.17116945214102,"lat":38.464453346515356, "count":1}, 
{"lng":117.22146699490091,"lat":39.12339025327971, "count":1}, 
{"lng":114.9405033729825,"lat":25.835176103497655, "count":1}, 
{"lng":112.12853720100244,"lat":32.014796804669224, "count":1}, 
{"lng":101.62247338027404,"lat":34.740396071091155, "count":3}, 
{"lng":117.20359278135501,"lat":39.15348514470478, "count":1}, 
{"lng":117.29057543439453,"lat":34.21266655011306, "count":1}, 
{"lng":103.93717563531006,"lat":30.608293840569402, "count":1}, 
{"lng":112.4393709396677,"lat":39.337108370541735, "count":1}, 
{"lng":119.65343619052916,"lat":29.084639385513697, "count":1}, 
{"lng":121.53251993732523,"lat":31.265524144657057, "count":2}, 
{"lng":129.4773763202274,"lat":42.91574303372181, "count":2}, 
{"lng":118.43943137653523,"lat":31.358536655799266, "count":1}, 
{"lng":103.72351177196889,"lat":27.34408386024681, "count":1}, 
{"lng":120.67502812714011,"lat":24.124036972028485, "count":1}, 
{"lng":106.63955268233484,"lat":30.461746110678995, "count":1}, 
{"lng":117.20359278135501,"lat":39.15348514470478, "count":1}, 
{"lng":113.58255478654918,"lat":22.27656465424921, "count":1}, 
{"lng":109.60552031033306,"lat":23.117448382037534, "count":1}, 
{"lng":121.48053886017651,"lat":31.235929042252014, "count":1}, 
{"lng":112.75959475565928,"lat":37.69283940975972, "count":1}, 
{"lng":116.62947017362819,"lat":23.662623192615886, "count":1}, 
{"lng":113.08855619524043,"lat":22.584603880965, "count":1}, 
{"lng":113.13946767446333,"lat":41.00074832767381, "count":1}, 
{"lng":111.01338945447925,"lat":35.03270691290923, "count":1}, 
{"lng":121.43045437545099,"lat":31.226847968225428, "count":2}, 
{"lng":117.20359278135501,"lat":39.15348514470478, "count":1}, 
{"lng":121.67640799865809,"lat":42.02802190131842, "count":1}, 
{"lng":113.99822095775265,"lat":22.537232055797077, "count":1}, 
{"lng":122.07749009021381,"lat":41.12587528873715, "count":1}, 
{"lng":107.02943020926463,"lat":33.073799907833795, "count":1}, 
{"lng":110.20354537457943,"lat":25.242885724872647, "count":1}, 
{"lng":116.68852864054833,"lat":23.35909171772515, "count":1}, ]
   
    if(!isSupportCanvas()){
    	alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~')
    }
	//详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md
	//参数说明如下:
	/* visible 热力图是否显示,默认为true
     * opacity 热力的透明度,1-100
     * radius 势力图的每个点的半径大小   
     * gradient  {JSON} 热力图的渐变区间 . gradient如下所示
     *	{
			.2:'rgb(0, 255, 255)',
			.5:'rgb(0, 110, 255)',
			.8:'rgb(100, 0, 255)'
		}
		其中 key 表示插值的位置, 0~1. 
		    value 为颜色值. 
     */
	heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":20});
	map.addOverlay(heatmapOverlay);
	heatmapOverlay.setDataSet({data:points,max:10});
	//是否显示热力图
    function openHeatmap(){
        heatmapOverlay.show();
    }
	function closeHeatmap(){
        heatmapOverlay.hide();
    }
	openHeatmap();
    function setGradient(){
     	/*格式如下所示:
		{
	  		0:'rgb(102, 255, 0)',
	 	 	.5:'rgb(255, 170, 0)',
		  	1:'rgb(255, 0, 0)'
		}*/
     	var gradient = {};
     	var colors = document.querySelectorAll("input[type='color']");
     	colors = [].slice.call(colors,0);
     	colors.forEach(function(ele){
			gradient[ele.getAttribute("data-key")] = ele.value; 
     	});
        heatmapOverlay.setOptions({"gradient":gradient});
    }
	//判断浏览区是否支持canvas
    function isSupportCanvas(){
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }
</script>